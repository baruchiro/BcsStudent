{
  "name": "Angie, Personal AI Assistant with Telegram Voice and Text",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "46511f47-1687-4cbe-ae41-ceb205ed1f11",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [-336, 1312],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "MASKED_OPENAI_ID",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "a0bf9719-4272-46f6-ab3b-eda6f7b44fd8",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.message.text }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "e791d4f8-2c19-4c14-a71e-39a04f22e944",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [112, 464],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "5bd1788a-3d08-4eb3-8e03-3ce82f44d2a7",
      "name": "Speech to Text",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [560, 400],
      "typeVersion": 1.3,
      "credentials": {
        "openAiApi": {
          "id": "MASKED_OPENAI_ID",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "text",
              "stringValue": "={{ $json?.message?.text || \"\" }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b67a2a93-517b-469e-aaa4-32c422710743",
      "name": "Voice or Text",
      "type": "n8n-nodes-base.set",
      "position": [-112, 368],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Telegram Trigger').item.json.message.voice.file_id }}"
      },
      "id": "8105c39f-9e87-44c4-9215-b3777f0b4164",
      "name": "Get Voice File",
      "type": "n8n-nodes-base.telegram",
      "position": [336, 400],
      "typeVersion": 1.1,
      "webhookId": "MASKED_WEBHOOK_ID",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_BOT_ID",
          "name": "AI Bot"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=אתה העוזר הכללי שלי.\nהתאריך היום: {{ $now }}.\n\nהוראות כלליות:\n- אם אתה לא יודע איך לעזור, או לא מצליח, תגיד לי איזה מידע יכול לעזור לך לבצע את המשימה.\n- אם יש שגיאה או תקלה, תתן לי תיאור קצר על התקלה.\n\nדברים שאתה יודע לעשות:\n- לנהל את נתוני הכספים והעובר ושב שלי, בעזרת Actual Budget\n- לתת לי סטטיסטיקות ואנליטיקות על האתר שלי (הבלוג) מתוך PostHog.\n\n\n"
        }
      },
      "id": "759b975f-d17c-4386-a5b3-12413f0361f4",
      "name": "Angie, AI Assistant 👩🏻‍🏫",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [-112, 1088],
      "typeVersion": 1.6,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "42d08aed-f267-464a-b19d-36ab65e18226",
              "leftValue": "={{ $json.message.chat.id }}",
              "rightValue": "MASKED_CHAT_ID",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-336, 560],
      "id": "765d382a-9aac-407b-9e73-b1b9b5fa5f19",
      "name": "only baruch"
    },
    {
      "parameters": {
        "chatId": "MASKED_CHAT_ID",
        "text": "={{ $json.message.from.first_name }} {{ $json.message.from.last_name }} (@{{ $json.message.from.username }}) (ChatID: {{ $json.message.chat.id }}) שלח את ההודעה הבאה:\n{{ $json.message.text }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-112, 560],
      "id": "4d34d8a3-3996-493a-b43c-f9f266ee7787",
      "name": "report",
      "webhookId": "MASKED_WEBHOOK_ID_2",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_ACCOUNT_ID",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.chat.id }}",
        "text": "סליחה אבל אתה לא מורשה להשתמש בבוט הזה",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-112, 752],
      "id": "8c9ad684-2257-4803-aa62-035a00bfaf39",
      "name": "reply",
      "webhookId": "MASKED_WEBHOOK_ID_3",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_ACCOUNT_ID",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendChatAction",
        "chatId": "={{ $json.message.chat.id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [112, 272],
      "id": "12423b82-44e0-4237-9919-f9fe8985e4e6",
      "name": "Telegram1",
      "webhookId": "MASKED_WEBHOOK_ID_4",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_BOT_ID",
          "name": "AI Bot"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [-560, 992],
      "id": "65df77af-5379-4d68-aded-47a2b0d31a10",
      "name": "When chat message received",
      "webhookId": "7b301e7c-d061-4416-822e-8e2ed4e17402"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "chatInput"
            },
            {
              "name": "sessionId"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [-560, 1184],
      "id": "ee58a2ce-bd89-4acf-a18a-0cea497e8298",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "8mITXyEcWWQlNAut",
          "mode": "list",
          "cachedResultName": "Angie, Personal AI Assistant with Telegram Voice and Text"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "chatInput": "={{ $json.text }}",
            "sessionId": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
          },
          "matchingColumns": ["chatInput"],
          "schema": [
            {
              "id": "chatInput",
              "displayName": "chatInput",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": true,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [784, 560],
      "id": "b24f910f-d7dc-4ee2-91af-9555209b6fc1",
      "name": "Execute Workflow1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}",
        "databaseName": "n8n"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryMongoDbChat",
      "typeVersion": 1,
      "position": [-208, 1312],
      "id": "55b5fe2d-956a-4ab2-ae79-ea0166c9ed20",
      "name": "MongoDB Chat Memory",
      "credentials": {
        "mongoDb": {
          "id": "MASKED_MONGODB_ID",
          "name": "MongoDB home-server"
        }
      }
    },
    {
      "parameters": {
        "sseEndpoint": "http://actual-mcp:3000/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [-80, 1312],
      "id": "6c7e27cf-cfca-421d-ad44-444f6d3aac93",
      "name": "Actual MCP"
    },
    {
      "parameters": {
        "sseEndpoint": "https://mcp.posthog.com/sse",
        "authentication": "bearerAuth",
        "include": "except",
        "excludeTools": [
          "feature-flag-get-definition",
          "feature-flag-get-all",
          "create-feature-flag",
          "update-feature-flag",
          "delete-feature-flag",
          "get-llm-total-costs-for-project"
        ]
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [48, 1312],
      "id": "852f8559-87eb-4883-9091-dc766b84fd79",
      "name": "PostHog MCP",
      "credentials": {
        "httpBearerAuth": {
          "id": "MASKED_POSTHOG_ID",
          "name": "PostHog Bearer Token"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "sseEndpoint": "http://homeassistant:8123/mcp_server/sse",
        "authentication": "bearerAuth"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [176, 1312],
      "id": "5a852a4c-6d14-48be-8f1a-1937d91d5383",
      "name": "HomeAssistant",
      "credentials": {
        "httpBearerAuth": {
          "id": "MASKED_HOMEASSISTANT_ID",
          "name": "HomeAssistant Bearer Auth account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [304, 1312],
      "id": "ea3a93f5-4cea-499f-a80d-9afb183809f3",
      "name": "Calculator"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [784, 352],
      "id": "355acb41-dfa2-47ba-a4fa-152b1a06ea15",
      "name": "Send a text message",
      "webhookId": "MASKED_WEBHOOK_ID_5",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_BOT_ID",
          "name": "AI Bot"
        }
      }
    },
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [-560, 560],
      "id": "193c3123-1d9e-4e13-aa24-bc0aa19cc914",
      "name": "Telegram Trigger",
      "webhookId": "MASKED_WEBHOOK_ID_6",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_BOT_ID",
          "name": "AI Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output || $json.error }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "id": "e35c04ff-a050-4564-8c1b-5b22b556872f",
      "name": "Send a text message1",
      "type": "n8n-nodes-base.telegram",
      "position": [1008, 560],
      "typeVersion": 1.1,
      "webhookId": "MASKED_WEBHOOK_ID_7",
      "credentials": {
        "telegramApi": {
          "id": "MASKED_TELEGRAM_BOT_ID",
          "name": "AI Bot"
        }
      },
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "If": {
      "main": [
        [
          {
            "node": "Get Voice File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute Workflow1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Voice or Text": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          },
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Voice File": {
      "main": [
        [
          {
            "node": "Speech to Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Speech to Text": {
      "main": [
        [
          {
            "node": "Execute Workflow1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Angie, AI Assistant 👩🏻‍🏫": {
      "main": [[], []]
    },
    "only baruch": {
      "main": [
        [
          {
            "node": "Voice or Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "reply",
            "type": "main",
            "index": 0
          },
          {
            "node": "report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "report": {
      "main": [[]]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow1": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram1": {
      "main": [[]]
    },
    "MongoDB Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Actual MCP": {
      "ai_tool": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "PostHog MCP": {
      "ai_tool": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "HomeAssistant": {
      "ai_tool": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "Angie, AI Assistant 👩🏻‍🏫",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "only baruch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message1": {
      "main": [[], []]
    }
  },
  "active": true,
  "settings": {
    "errorWorkflow": "0XeTyWlTIKHuYayj"
  },
  "versionId": "1ddc010b-bc36-49e4-a0e4-1ffa438ac61c",
  "meta": {
    "templateId": "2462",
    "templateCredsSetupCompleted": true,
    "instanceId": "a30e88684748bb9b714b1a5cc72af46ed3eae1317210264b827a880e25dfd2f7"
  },
  "id": "MASKED_WORKFLOW_ID",
  "tags": []
}
